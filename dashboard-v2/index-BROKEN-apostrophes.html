<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>BAG Bot Dashboard V2 Ultra-Complet</title>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:sans-serif;background:#111;color:#fff}
.sidebar{width:240px;height:100vh;position:fixed;background:#1a1a1a;padding:20px;overflow-y:auto}
.main{margin-left:240px;padding:30px}
.card{background:#222;padding:20px;border-radius:12px;margin-bottom:20px}
.nav{padding:12px;border-radius:8px;cursor:pointer;margin-bottom:6px}
.nav.active{background:linear-gradient(90deg,#5865F2,#4752C4)}
.btn{padding:10px 20px;border-radius:8px;font-weight:600;border:none;cursor:pointer;margin-right:8px}
.btn-primary{background:#5865F2;color:white}
.btn-success{background:#57F287;color:#000}
.btn-danger{background:#ED4245;color:white}
input,select,textarea{padding:10px;border-radius:6px;border:2px solid #333;background:#0a0a0a;color:white;width:100%}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #333}
.tab{padding:10px 20px;border-radius:8px;cursor:pointer;background:#222;display:inline-block;margin:0 8px 8px 0;font-weight:600}
.tab.active{background:linear-gradient(90deg,#5865F2,#4752C4)}
.field-group{background:#1a1a1a;padding:15px;border-radius:8px;margin-bottom:15px}
.field-group h4{margin-bottom:10px;color:#5865F2;font-size:16px}
</style>
</head>
<body>
<div id="app">
<div class="sidebar">
<h1 style="font-size:20px;margin-bottom:20px;">ğŸ¤– BAG Bot V2</h1>
<div class="nav" :class="{active:v==='d'}" @click="v='d'">ğŸ  Dashboard</div>
<div class="nav" :class="{active:v==='eco'}" @click="v='eco';load()">ğŸ’° Ã‰conomie</div>
<div class="nav" :class="{active:v==='niv'}" @click="v='niv';load()">ğŸ“ˆ Niveaux</div>
<div class="nav" :class="{active:v==='boost'}" @click="v='boost';load()">ğŸš€ Booster</div>
<div class="nav" :class="{active:v==='count'}" @click="v='count';load()">ğŸ”¢ Comptage</div>
<div class="nav" :class="{active:v==='av'}" @click="v='av';load()">ğŸ² A/V</div>
<div class="nav" :class="{active:v==='logs'}" @click="v='logs';load()">ğŸ“ Logs</div>
<div class="nav" :class="{active:v==='tick'}" @click="v='tick';load()">ğŸ« Tickets</div>
<div class="nav" :class="{active:v==='conf'}" @click="v='conf';load()">ğŸ’¬ Confess</div>
<div class="nav" :class="{active:v==='welcome'}" @click="v='welcome';loadWelcome()">ğŸ‘‹ Bienvenue/DÃ©part</div>
<div class="nav" :class="{active:v==='bak'}" @click="v='bak';load()">ğŸ’¾ Backups</div>
<div class="nav" :class="{active:v==='staff'}" @click="v='staff';loadStaff()">ğŸ‘¥ Staff</div>
<div class="nav" :class="{active:v==='autokick'}" @click="v='autokick';loadAutoKick()">âš¡ AutoKick</div>
<div class="nav" :class="{active:v==='autothread'}" @click="v='autothread';loadAutoThread()">ğŸ§µ AutoThread</div>
<div class="nav" :class="{active:v==='disboard'}" @click="v='disboard';loadDisboard()">ğŸ“¢ Disboard</div>
<div class="nav" :class="{active:v==='geo'}" @click="v='geo';loadGeo()">ğŸ—ºï¸ GÃ©o</div>
<div class="nav" :class="{active:v===''actions''}" @click="v=''actions'';loadActions()">âš¡ Actions</div>
<div class="nav" :class="{active:v==='ctrl'}" @click="v='ctrl'">ğŸ® ContrÃ´le Bot</div>
<div class="nav" onclick="window.location.href='/music'" style="cursor:pointer;background:linear-gradient(90deg,#ED4245,#C53030)">ğŸµ Musique (nouveau)</div>

</div>

<div class="main">

<!-- Dashboard -->
<div v-show="v==='d'">
<h2 style="font-size:28px;margin-bottom:20px;">Dashboard</h2>
<div class="card">
<p style="margin-bottom:10px;">Ã‰conomie: <strong>{{Object.keys(eco).length}}</strong></p>
<p style="margin-bottom:10px;">Niveaux: <strong>{{Object.keys(niv).length}}</strong></p>
<p style="margin-bottom:20px;">Prompts: <strong>{{tdS.length+tdN.length}}</strong></p>
<button @click="load()" class="btn btn-primary">RafraÃ®chir</button>
</div>
</div>

<!-- Ã‰conomie -->
<div v-show="v==='eco'">
<h2 style="font-size:28px;margin-bottom:20px;">ğŸ’° Ã‰conomie ({{Object.keys(eco).length}})</h2>
<div style="margin-bottom:20px;">
<span class="tab" :class="{active:ecoT==='u'}" @click="ecoT='u'">Users</span>
<span class="tab" :class="{active:ecoT==='s'}" @click="ecoT='s'">Settings</span>
<span class="tab" :class="{active:ecoT==='c'}" @click="ecoT='c'">Cooldowns</span>
<span class="tab" :class="{active:ecoT==='a'}" @click="ecoT='a'">Actions</span>
<span class="tab" :class="{active:ecoT==='k'}" @click="ecoT='k'">Karma</span>
</div>
<div v-show="ecoT==='u'" class="card">
<table>
<thead><tr><th>#</th><th>Membre</th><th>Montant</th><th>Charme</th><th>Perv</th></tr></thead>
<tbody><tr v-for="([uid,d],i) in sortedEco()" :key="uid">
<td>{{i+1}}</td><td style="font-weight:500;">{{getMemberName(uid)}}</td>
<td style="font-weight:bold;color:#57F287;">{{(d.amount||0).toLocaleString()}} {{curr}}</td>
<td>ğŸ«¦ {{d.charm||0}}</td><td>ğŸ˜ˆ {{d.perversion||0}}</td>
</tr></tbody>
</table>
</div>
<div v-show="ecoT==='s'" class="card">
<div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
<div><label>Travail</label><input type="number" v-model.number="ecoW"></div>
<div><label>PÃªche</label><input type="number" v-model.number="ecoF"></div>
<div><label>Devise</label><input v-model="curr"></div>
</div>
<button @click="saveEco()" class="btn btn-success" style="margin-top:15px;">Sauvegarder</button>
</div>
<div v-show="ecoT==='c'" class="card">
<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;">
<div v-for="(val,act) in cool" :key="act">
<label style="font-size:13px;">{{act}}</label>
<input type="number" v-model.number="cool[act]" style="font-size:13px;">
</div>
</div>
</div>
<div v-show="ecoT==='a'" class="card">
<select v-model="selAct" @change="loadAct()" style="margin-bottom:15px;">
<option :value="null">SÃ©lectionner...</option>
<option v-for="a in Object.keys(actCfg).sort()" :key="a" :value="a">{{a}}</option>
</select>
<div v-if="curAct" style="max-height:600px;overflow-y:auto;">
<!-- SuccÃ¨s -->
<div class="field-group">
<h4>âœ… RÃ©ussite</h4>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
<div><label>Argent Min</label><input type="number" v-model.number="curAct.moneyMin"></div>
<div><label>Argent Max</label><input type="number" v-model.number="curAct.moneyMax"></div>
<div><label>Karma</label><select v-model="curAct.karma"><option value="none">Aucun</option><option value="charm">Charme</option><option value="perversion">Perversion</option></select></div>
<div><label>Karma Î”</label><input type="number" v-model.number="curAct.karmaDelta"></div>
<div><label>XP</label><input type="number" v-model.number="curAct.xpDelta"></div>
<div><label>Taux SuccÃ¨s</label><input type="number" v-model.number="curAct.successRate" step="0.01" min="0" max="1"></div>
</div>
</div>
<!-- Ã‰chec -->
<div class="field-group">
<h4>âŒ Ã‰chec</h4>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
<div><label>Argent Min (Ã©chec)</label><input type="number" v-model.number="curAct.failMoneyMin"></div>
<div><label>Argent Max (Ã©chec)</label><input type="number" v-model.number="curAct.failMoneyMax"></div>
<div><label>Karma Î” (Ã©chec)</label><input type="number" v-model.number="curAct.failKarmaDelta"></div>
<div><label>XP (Ã©chec)</label><input type="number" v-model.number="curAct.failXpDelta"></div>
</div>
</div>
<!-- Partenaire -->
<div class="field-group">
<h4>ğŸ‘¥ Partenaire</h4>
<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;">
<div><label>Part Argent</label><input type="number" v-model.number="curAct.partnerMoneyShare" step="0.01" min="0" max="1"></div>
<div><label>Part Karma</label><input type="number" v-model.number="curAct.partnerKarmaShare" step="0.01" min="0" max="1"></div>
<div><label>Part XP</label><input type="number" v-model.number="curAct.partnerXpShare" step="0.01" min="0" max="1"></div>
</div>
</div>
<!-- Autres -->
<div class="field-group">
<h4>âš™ï¸ Autres paramÃ¨tres</h4>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
<div><label>Cooldown (sec)</label><input type="number" v-model.number="curAct.cooldown"></div>
<div v-if="curAct.zones"><label>Zones</label><input v-model="curAct.zones" readonly></div>
</div>
</div>
</div>
</div>
<div v-show="ecoT==='k'" class="card">
<h3 style="margin-bottom:15px;">Configuration Karma</h3>
<div class="field-group">
<h4>ğŸ”„ Reset Automatique</h4>
<label><input type="checkbox" v-model="karmaRes.enabled" style="width:auto;margin-right:10px;">Activer le reset automatique</label>
<div v-if="karmaRes.enabled" style="margin-top:15px;">
<label>Jour de reset</label>
<select v-model.number="karmaRes.day" style="margin-top:5px;">
<option :value="0">Dimanche</option><option :value="1">Lundi</option><option :value="2">Mardi</option>
<option :value="3">Mercredi</option><option :value="4">Jeudi</option><option :value="5">Vendredi</option><option :value="6">Samedi</option>
</select>
</div>
</div>
<div class="field-group" style="margin-top:15px;">
<h4>ğŸ“Š Statistiques</h4>
<p style="margin-bottom:5px;">Utilisateurs avec charme: <strong>{{Object.values(eco).filter(u=>u.charm>0).length}}</strong></p>
<p>Utilisateurs avec perversion: <strong>{{Object.values(eco).filter(u=>u.perversion>0).length}}</strong></p>
</div>
</div>
</div>

<!-- Niveaux -->
<div v-show="v==='niv'">
<h2 style="font-size:28px;margin-bottom:20px;">ğŸ“ˆ Niveaux ({{Object.keys(niv).length}})</h2>
<div style="margin-bottom:20px;">
<span class="tab" :class="{active:nivT==='u'}" @click="nivT='u'">Users</span>
<span class="tab" :class="{active:nivT==='xp'}" @click="nivT='xp'">Config XP</span>
<span class="tab" :class="{active:nivT==='r'}" @click="nivT='r'">Rewards</span>
<span class="tab" :class="{active:nivT==='an'}" @click="nivT='an'">Annonces</span>
<span class="tab" :class="{active:nivT==='ca'}" @click="nivT='ca'">Cartes</span>
</div>
<div v-show="nivT==='u'" class="card">
<table>
<thead><tr><th>#</th><th>Membre</th><th>Niveau</th><th>XP</th><th>Messages</th></tr></thead>
<tbody><tr v-for="([uid,d],i) in sortedNiv()" :key="uid">
<td>{{i+1}}</td><td style="font-weight:500;">{{getMemberName(uid)}}</td>
<td style="font-weight:bold;color:#FEE75C;font-size:20px;">{{d.level||0}}</td>
<td>{{(d.xp||0).toLocaleString()}}</td><td>{{d.messages||0}}</td>
</tr></tbody>
</table>
</div>
<div v-show="nivT==='xp'" class="card">
<h3 style="margin-bottom:15px;">Configuration XP</h3>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
<div><label>XP Message Min</label><input type="number" v-model.number="nivXpMsgMin"></div>
<div><label>XP Message Max</label><input type="number" v-model.number="nivXpMsgMax"></div>
<div><label>XP Vocal Min</label><input type="number" v-model.number="nivXpVoiceMin"></div>
<div><label>XP Vocal Max</label><input type="number" v-model.number="nivXpVoiceMax"></div>
<div><label>Cooldown Message (sec)</label><input type="number" v-model.number="nivCoolMsg"></div>
<div><label>Cooldown Vocal (sec)</label><input type="number" v-model.number="nivCoolVoice"></div>
</div>
</div>
<div v-show="nivT==='r'" class="card">
<h3 style="margin-bottom:15px;">RÃ©compenses (RÃ´les par Niveau)</h3>
<p>Config rewards : {{Object.keys(nivRewards).length}} niveaux</p>
</div>
<div v-show="nivT==='an'" class="card">
<h3 style="margin-bottom:15px;">Annonces Level Up</h3>
<p v-if="nivLevelUpChannel" style="padding:10px;background:#1a1a1a;margin:10px 0;border-radius:6px;">
Canal: <strong>{{getChannelName(nivLevelUpChannel)}}</strong>
<span style="opacity:0.6;font-size:11px;margin-left:10px;">{{nivLevelUpChannel}}</span>
</p>
<p v-else style="opacity:0.7;padding:15px;text-align:center;">Non configurÃ©</p>
</div>
<div v-show="nivT==='an'" class="card">
<h3 style="margin-bottom:15px;">Annonces Role Award</h3>
<p v-if="nivRoleAwardChannel" style="padding:10px;background:#1a1a1a;margin:10px 0;border-radius:6px;">
Canal: <strong>{{getChannelName(nivRoleAwardChannel)}}</strong>
<span style="opacity:0.6;font-size:11px;margin-left:10px;">{{nivRoleAwardChannel}}</span>
</p>
<p v-else style="opacity:0.7;padding:15px;text-align:center;">Non configurÃ©</p>
</div>
<div v-show="nivT==='ca'" class="card">
<h3 style="margin-bottom:15px;">Cartes de Niveau</h3>
<p>Config backgrounds et styles</p>
</div>
</div>

<!-- Booster -->
<div v-show="v==='boost'">
<h2 style="font-size:28px;margin-bottom:20px;">ğŸš€ Booster</h2>
<div class="card">
<label><input type="checkbox" v-model="boost.enabled" style="width:auto;margin-right:10px;">Activer SystÃ¨me Booster</label>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:20px;">
<div><label>XP Texte (Ã—)</label><input type="number" v-model.number="boost.textXpMult" step="0.1"></div>
<div><label>XP Vocal (Ã—)</label><input type="number" v-model.number="boost.voiceXpMult" step="0.1"></div>
<div><label>Cooldown Actions (Ã—)</label><input type="number" v-model.number="boost.actionCooldownMult" step="0.1"></div>
<div><label>Prix Shop (Ã—)</label><input type="number" v-model.number="boost.shopPriceMult" step="0.1"></div>
</div>
<div style="margin-top:20px;">
<h4 style="margin-bottom:10px;">RÃ´les Booster ({{boost.roles?.length||0}})</h4>
<div v-if="boost.roles && boost.roles.length > 0" style="background:#1a1a1a;padding:15px;border-radius:8px;">
<div v-for="(role,i) in boost.roles" :key="i" style="padding:8px;background:#0a0a0a;margin-bottom:8px;border-radius:6px;font-size:13px;">
<strong>{{getRoleName(role)}}</strong>
<div style="opacity:0.6;font-size:11px;font-family:monospace;margin-top:4px;">ID: {{role}}</div>
</div>
</div>
<div v-else style="padding:20px;text-align:center;opacity:0.7;">
Aucun rÃ´le configurÃ©
</div>
</div>
</div>
</div>

<!-- Comptage -->
<div v-show="v==='count'">
<h2 style="font-size:28px;margin-bottom:20px;">ğŸ”¢ Comptage</h2>
<div class="card">
<label><input type="checkbox" v-model="countFormulas" style="width:auto;margin-right:10px;">Formules AutorisÃ©es</label>
<div style="margin-top:20px;">
<p style="margin-bottom:10px;">Nombre Actuel: <strong style="font-size:24px;color:#FEE75C;">{{countState.current||0}}</strong></p>
<p style="margin-bottom:10px;">Dernier User: <span style="font-family:monospace;">{{getMemberName(countState.lastUserId)||'Aucun'}}</span></p>
<p style="margin-bottom:10px;">Nombres Atteints: <strong>{{countAch.length}}</strong></p>
<div style="max-height:200px;overflow-y:auto;background:#1a1a1a;padding:10px;border-radius:8px;">
{{countAch.join(', ')}}
</div>
</div>
</div>
<div class="card">
<h3>ğŸ“ Channels Comptage ({{(countChannels||[]).length}})</h3>
<div v-if="(countChannels||[]).length>0" style="margin:15px 0;">
<div v-for="ch in countChannels" :key="ch" style="padding:8px;background:#1a1a1a;margin:5px 0;border-radius:6px;font-size:13px;">
<strong>{{getChannelName(ch)}}</strong>
<span style="opacity:0.6;font-size:11px;margin-left:10px;">{{ch}}</span>
</div>
</div>
<p v-else style="opacity:0.7;padding:15px;text-align:center;">Aucun canal configurÃ©</p>
</div>
</div>

<!-- Action/VÃ©ritÃ© -->
<div v-show="v==='av'">
<h2 style="font-size:28px;margin-bottom:20px;">ğŸ² Action/VÃ©ritÃ©</h2>
<div style="margin-bottom:20px;">
<span class="tab" :class="{active:avT==='config'}" @click="avT='config'">Config AouV</span>
<span class="tab" :class="{active:avT==='prompt'}" @click="avT='prompt'">Prompts</span>
</div>
<div v-show="avT==='config'" class="card">
<h3 style="margin-bottom:15px;">Channels</h3>
<div style="margin-bottom:15px;">
<span class="tab" :class="{active:avMode==='sfw'}" @click="avMode='sfw'">ğŸŸ¢ SFW</span>
<span class="tab" :class="{active:avMode==='nsfw'}" @click="avMode='nsfw'">ğŸ”´ NSFW</span>
</div>
<div style="margin:15px 0;">
<div v-if="avMode==='sfw' && tdSfwCh.length>0">
<div v-for="ch in tdSfwCh" :key="ch" style="padding:8px;background:#1a1a1a;margin:5px 0;border-radius:6px;font-size:13px;">
<strong>{{getChannelName(ch)}}</strong>
<span style="opacity:0.6;font-size:11px;margin-left:10px;">{{ch}}</span>
</div>
</div>
<div v-if="avMode==='nsfw' && tdNsfwCh.length>0">
<div v-for="ch in tdNsfwCh" :key="ch" style="padding:8px;background:#1a1a1a;margin:5px 0;border-radius:6px;font-size:13px;">
<strong>{{getChannelName(ch)}}</strong>
<span style="opacity:0.6;font-size:11px;margin-left:10px;">{{ch}}</span>
</div>
</div>
<p v-if="(avMode==='sfw' && tdSfwCh.length===0) || (avMode==='nsfw' && tdNsfwCh.length===0)" style="opacity:0.7;padding:15px;text-align:center;">Aucun canal</p>
</div>
</div>
<div v-show="avT==='prompt'" class="card">
<div style="margin-bottom:15px;">
<span class="tab" :class="{active:avMode==='sfw'}" @click="avMode='sfw'">ğŸŸ¢ SFW ({{tdS.length}})</span>
<span class="tab" :class="{active:avMode==='nsfw'}" @click="avMode='nsfw'">ğŸ”´ NSFW ({{tdN.length}})</span>
</div>
<div style="margin-bottom:20px;background:#0f0f0f;padding:15px;border-radius:8px;border:1px solid #333;">
<h4 style="margin-bottom:10px;color:#FEE75C;">âœï¸ Ajouter des Prompts</h4>
<div style="margin-bottom:15px;">
<label style="display:block;margin-bottom:8px;font-weight:600;">Type de prompts Ã  ajouter:</label>
<select v-model="tdNewType" style="width:100%;padding:10px;background:#1a1a1a;border:1px solid #555;border-radius:6px;color:#fff;font-size:14px;cursor:pointer;">
<option value="verite">âœ… VÃ©ritÃ©s</option>
<option value="action">ğŸ¯ Actions</option>
</select>
</div>
<p style="font-size:13px;opacity:0.8;margin-bottom:10px;">Entrez vos prompts (un par ligne, pas besoin de prÃ©ciser le type):</p>
<textarea v-model="tdNewPrompts" placeholder="Quelle est ta couleur prÃ©fÃ©rÃ©e?
Fais 10 pompes
Quel est ton film prÃ©fÃ©rÃ©?
Chante une chanson" style="width:100%;min-height:120px;padding:12px;background:#1a1a1a;border:1px solid #555;border-radius:8px;color:#fff;font-family:monospace;font-size:13px;resize:vertical;"></textarea>
<div style="margin-top:10px;display:flex;gap:10px;">
<button @click="submitTdPromptsSimple(avMode)" class="btn btn-success">âœ… Ajouter les Prompts</button>
<button @click="tdNewPrompts=''; " class="btn" style="background:#666;">ğŸ—‘ï¸ Effacer</button>
</div>
</div>
</div>
<div style="margin-bottom:15px;">
<label style="display:block;margin-bottom:8px;font-weight:600;color:#FEE75C;">Type de prompts Ã  afficher:</label>
<select v-model="avType" style="width:100%;padding:10px;background:#1a1a1a;border:1px solid #555;border-radius:6px;color:#fff;font-size:14px;cursor:pointer;">
<option value="v">âœ… VÃ©ritÃ©s</option>
<option value="a">ğŸ¯ Actions</option>
</select>
</div>
<div style="max-height:400px;overflow-y:auto;">
<div v-if="avMode==='sfw'&&avType==='v'">
<div v-for="(p,i) in tdS.filter(x=>x.type==='verite')" :key="i" style="padding:12px;background:#1a1a1a;margin-bottom:8px;border-radius:8px;border-left:4px solid #57F287;">
<div style="font-weight:bold;color:#57F287;">{{i+1}}. <span style="font-size:11px;">ID {{p.id}}</span></div>
<div>{{p.text}}</div>
</div>
</div>
<div v-if="avMode==='sfw'&&avType==='a'">
<div v-for="(p,i) in tdS.filter(x=>x.type==='action')" :key="i" style="padding:12px;background:#1a1a1a;margin-bottom:8px;border-radius:8px;border-left:4px solid #57F287;">
<div style="font-weight:bold;color:#57F287;">{{i+1}}. <span style="font-size:11px;">ID {{p.id}}</span></div>
<div>{{p.text}}</div>
</div>
</div>
<div v-if="avMode==='nsfw'&&avType==='v'">
<div v-for="(p,i) in tdN.filter(x=>x.type==='verite')" :key="i" style="padding:12px;background:#1a1a1a;margin-bottom:8px;border-radius:8px;border-left:4px solid #ED4245;">
<div style="font-weight:bold;color:#ED4245;">{{i+1}}. <span style="font-size:11px;">ID {{p.id}}</span></div>
<div>{{p.text}}</div>
</div>
</div>
<div v-if="avMode==='nsfw'&&avType==='a'">
<div v-for="(p,i) in tdN.filter(x=>x.type==='action')" :key="i" style="padding:12px;background:#1a1a1a;margin-bottom:8px;border-radius:8px;border-left:4px solid #ED4245;">
<div style="font-weight:bold;color:#ED4245;">{{i+1}}. <span style="font-size:11px;">ID {{p.id}}</span></div>
<div>{{p.text}}</div>
</div>
</div>
</div>
</div>
</div>

<!-- Logs -->
<div v-show="v==='logs'">
<h2 style="font-size:28px;margin-bottom:20px;">ğŸ“ Logs</h2>
<div class="card">
<h3>Channels de Logs ConfigurÃ©s</h3>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:15px;">
<div v-for="(channelId, type) in logChannels" :key="type" style="padding:10px;background:#1a1a1a;border-radius:6px;">
<div style="font-weight:bold;font-size:12px;text-transform:uppercase;color:#5865F2;margin-bottom:5px;">{{type}}</div>
<div style="font-size:13px;">{{getChannelName(channelId)}}</div>
<div style="opacity:0.5;font-size:10px;margin-top:2px;">{{channelId}}</div>
</div>
</div>
</div>
</div>

<!-- Tickets -->
<div v-show="v==='tick'">
<h2>ğŸ« Tickets ({{tickCounter}})</h2>
<div style="margin:20px 0;">
<span class="tab" :class="{active:tickT==='config'}" @click="tickT='config'">âš™ï¸ Config</span>
<span class="tab" :class="{active:tickT==='cats'}" @click="tickT='cats'">ğŸ“ CatÃ©gories</span>
<span class="tab" :class="{active:tickT==='hist'}" @click="tickT='hist'">ğŸ“‹ Historique</span>
<span class="tab" :class="{active:tickT==='panel'}" @click="tickT='panel'">ğŸ¨ Panel</span>
</div>

<div v-show="tickT==='config'" class="card">
<h3>âš™ï¸ Configuration</h3>
<div class="field-group">
<label style="display:flex;gap:8px;align-items:center;">
<input type="checkbox" v-model="tickEnabled" disabled style="width:auto;">
SystÃ¨me activÃ© ({{tickEnabled?'Oui':'Non'}})
</label>
</div>
<div class="field-group">
<label style="display:flex;gap:8px;align-items:center;">
<input type="checkbox" v-model="editingConfig" style="width:auto;">
âœï¸ Mode Ã©dition
</label>
</div>
<div class="field-group">
<h4>Channels</h4>
<div style="display:grid;grid-template-columns:1fr;gap:12px;margin-top:10px;">
<div>
<label style="font-size:13px;opacity:0.8;">ğŸ“ CatÃ©gorie Discord</label>
<select v-if="editingConfig" v-model="tickConfig.categoryId" style="margin-top:5px;">
<option value="">-- SÃ©lectionner --</option>
<option v-for="(name,id) in channels" :key="id" :value="id">{{name}}</option>
</select>
<input v-else :value="getChannelName(tickConfig.categoryId)" readonly style="margin-top:5px;background:#1a1a1a;">
</div>
<div>
<label style="font-size:13px;opacity:0.8;">ğŸ¨ Channel du Panel</label>
<select v-if="editingConfig" v-model="tickConfig.panelChannelId" style="margin-top:5px;">
<option value="">-- SÃ©lectionner --</option>
<option v-for="(name,id) in channels" :key="id" :value="id">{{name}}</option>
</select>
<input v-else :value="getChannelName(tickConfig.panelChannelId)" readonly style="margin-top:5px;background:#1a1a1a;">
</div>
<div>
<label style="font-size:13px;opacity:0.8;">ğŸ“‹ Channel des Logs</label>
<select v-if="editingConfig" v-model="tickConfig.logChannelId" style="margin-top:5px;">
<option value="">-- SÃ©lectionner --</option>
<option v-for="(name,id) in channels" :key="id" :value="id">{{name}}</option>
</select>
<input v-else :value="getChannelName(tickConfig.logChannelId)" readonly style="margin-top:5px;background:#1a1a1a;">
</div>
<div>
<label style="font-size:13px;opacity:0.8;">ğŸ“„ Channel des Transcripts</label>
<select v-if="editingConfig" v-model="tickConfig.transcriptChannelId" style="margin-top:5px;">
<option value="">-- SÃ©lectionner --</option>
<option v-for="(name,id) in channels" :key="id" :value="id">{{name}}</option>
</select>
<input v-else :value="getChannelName(tickConfig.transcriptChannelId)" readonly style="margin-top:5px;background:#1a1a1a;">
</div>
</div>
</div>
<div v-if="editingConfig" style="margin-top:20px;">
<button @click="saveConfig" class="btn btn-success">ğŸ’¾ Sauvegarder</button>
<button @click="editingConfig=false" class="btn" style="background:#666;">âŒ Annuler</button>
</div>
</div>

<div v-show="tickT==='cats'" class="card">
<h3>CatÃ©gories ({{tickCats.length}})</h3>
<div v-for="(cat,idx) in tickCats" :key="cat.key" style="background:#1a1a1a;padding:15px;margin:10px 0;border-radius:8px;">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
<h4 style="margin:0;">{{cat.emoji}} {{cat.label}} <span style="opacity:0.6;font-size:12px;">({{cat.key}})</span></h4>
<button v-if="editingCat!==idx" @click="editingCat=idx" class="btn btn-primary" style="padding:6px 12px;font-size:12px;">âœï¸ Modifier</button>
<div v-else>
<button @click="saveCat(idx)" class="btn btn-success" style="padding:6px 12px;font-size:12px;margin-right:5px;">ğŸ’¾ Sauvegarder</button>
<button @click="editingCat=-1" class="btn" style="padding:6px 12px;font-size:12px;background:#666;">âŒ Annuler</button>
</div>
</div>
<div style="margin-bottom:10px;">
<label style="font-size:12px;opacity:0.8;">Label</label>
<input v-model="cat.label" :readonly="editingCat!==idx" style="margin-top:5px;">
</div>
<div style="margin-bottom:10px;">
<label style="font-size:12px;opacity:0.8;">Emoji</label>
<input v-model="cat.emoji" :readonly="editingCat!==idx" style="margin-top:5px;">
</div>
<div style="margin-bottom:10px;">
<label style="font-size:12px;opacity:0.8;">Description</label>
<textarea v-model="cat.description" :readonly="editingCat!==idx" rows="2" style="margin-top:5px;"></textarea>
</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;font-size:13px;">
<div><strong>Staff Roles:</strong> {{cat.staffPingRoleIds.length}}</div>
<div><strong>Viewer Roles:</strong> {{cat.extraViewerRoleIds.length}}</div>
</div>
<div v-if="cat.bannerUrl" style="margin-top:8px;">
<label style="font-size:12px;opacity:0.8;">Banner URL</label>
<input v-model="cat.bannerUrl" :readonly="editingCat!==idx" style="font-size:11px;margin-top:5px;">
</div>
</div>
</div>

<div v-show="tickT==='hist'" class="card">
<h3>Historique ({{Object.keys(tickRecords).length}})</h3>
<p style="opacity:0.8;margin:10px 0;">
<strong>Ouverts:</strong> {{Object.values(tickRecords).filter(function(t){return!t.closedAt}).length}} | 
<strong>FermÃ©s:</strong> {{Object.values(tickRecords).filter(function(t){return t.closedAt}).length}}
</p>
<div style="max-height:400px;overflow-y:auto;">
<table style="width:100%;font-size:13px;">
<thead>
<tr style="background:#1a1a1a;">
<th style="padding:8px;">ID</th>
<th style="padding:8px;">CatÃ©gorie</th>
<th style="padding:8px;">Statut</th>
</tr>
</thead>
<tbody>
<tr v-for="(rec,id) in tickRecords" :key="id" style="border-bottom:1px solid #2b2b2b;">
<td style="padding:8px;font-family:monospace;font-size:11px;">{{id.slice(-6)}}</td>
<td style="padding:8px;">{{rec.categoryKey}}</td>
<td style="padding:8px;">
<span v-if="rec.closedAt" style="padding:4px 8px;background:#57F287;color:#000;border-radius:4px;font-size:11px;">FermÃ©</span>
<span v-else style="padding:4px 8px;background:#FEE75C;color:#000;border-radius:4px;font-size:11px;">Ouvert</span>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div v-show="tickT==='panel'" class="card">
<h3>ğŸ¨ Panel Ticket</h3>
<div class="field-group">
<label>Titre</label>
<input v-model="tickPanel.title" placeholder="Titre du panel">
</div>
<div class="field-group">
<label>Texte</label>
<textarea v-model="tickPanel.text" rows="4" placeholder="Message du panel"></textarea>
</div>
<div class="field-group">
<label>Couleur (hex)</label>
<input v-model="tickPanel.color" placeholder="#5865F2">
</div>
<div class="field-group">
<label>URL de l'image</label>
<div style="display:flex;gap:10px;">
<input v-model="tickPanel.imageUrl" placeholder="https://..." style="flex:1;">
<input type="file" @change="uploadImage($event,'imageUrl')" accept="image/*" style="width:auto;background:#5865F2;color:white;cursor:pointer;padding:8px;">
</div>
</div>
<div class="field-group">
<label>URL de la miniature</label>
<div style="display:flex;gap:10px;">
<input v-model="tickPanel.thumbnailUrl" placeholder="https://..." style="flex:1;">
<input type="file" @change="uploadImage($event,'thumbnailUrl')" accept="image/*" style="width:auto;background:#5865F2;color:white;cursor:pointer;padding:8px;">
</div>
</div>
<div class="field-group">
<label>Footer (texte en bas)</label>
<input v-model="tickPanel.footer" placeholder="Texte du footer">
</div>
<div class="field-group">
<label>Timestamp</label>
<label style="display:flex;gap:8px;align-items:center;margin-top:5px;">
<input type="checkbox" v-model="tickPanel.timestamp" style="width:auto;">
Afficher le timestamp
</label>
</div>
<div style="margin-top:20px;">
<button @click="savePanel" class="btn btn-success">ğŸ’¾ Sauvegarder le Panel</button>
</div>
</div>

</div>
<!-- Confessions -->
<div v-show="v==='conf'">
<h2 style="font-size:28px;margin-bottom:20px;">ğŸ’¬ Confessions</h2>
<div class="card">
<h3>ğŸŸ¢ SFW Channels ({{(confess.sfw?.channels||[]).length}})</h3>
<div v-if="(confess.sfw?.channels||[]).length>0" style="margin:15px 0;">
<div v-for="ch in confess.sfw.channels" :key="ch" style="padding:8px;background:#1a1a1a;margin:5px 0;border-radius:6px;font-size:13px;">
<strong>{{getChannelName(ch)}}</strong>
<span style="opacity:0.6;font-size:11px;margin-left:10px;">{{ch}}</span>
</div>
</div>
<p v-else style="opacity:0.7;padding:15px;text-align:center;">Aucun canal SFW</p>
</div>
<div class="card">
<h3>ğŸ”´ NSFW Channels ({{(confess.nsfw?.channels||[]).length}})</h3>
<div v-if="(confess.nsfw?.channels||[]).length>0" style="margin:15px 0;">
<div v-for="ch in confess.nsfw.channels" :key="ch" style="padding:8px;background:#1a1a1a;margin:5px 0;border-radius:6px;font-size:13px;">
<strong>{{getChannelName(ch)}}</strong>
<span style="opacity:0.6;font-size:11px;margin-left:10px;">{{ch}}</span>
</div>
</div>
<p v-else style="opacity:0.7;padding:15px;text-align:center;">Aucun canal NSFW</p>
</div>
<div class="card">
<h3>ğŸ“ Canal de Log</h3>
<p v-if="confess.logChannelId" style="padding:10px;background:#1a1a1a;margin:10px 0;border-radius:6px;">
<strong>{{getChannelName(confess.logChannelId)}}</strong>
<span style="opacity:0.6;font-size:11px;margin-left:10px;">{{confess.logChannelId}}</span>
</p>
<p v-else style="opacity:0.7;padding:15px;text-align:center;">Non configurÃ©</p>
</div>
</div>

<!-- Welcome/Goodbye -->
<div v-show="v==='welcome'">
<h2 style="font-size:28px;margin-bottom:20px;">ğŸ‘‹ Bienvenue / DÃ©part</h2>

<!-- Tabs -->
<div style="margin-bottom:20px;">
<span class="tab" :class="{active:welcomeTab==='welcome'}" @click="welcomeTab='welcome'">ğŸ‰ Bienvenue</span>
<span class="tab" :class="{active:welcomeTab==='goodbye'}" @click="welcomeTab='goodbye'">ğŸ˜¢ DÃ©part</span>
</div>

<!-- Welcome Config -->
<div v-show="welcomeTab==='welcome'" class="card">
<h3 style="margin-bottom:15px;color:#57F287;">Configuration des messages de bienvenue</h3>

<div class="field-group">
<h4>ğŸ”§ ParamÃ¨tres gÃ©nÃ©raux</h4>
<label style="display:flex;align-items:center;margin-bottom:10px;">
<input type="checkbox" v-model="welcomeConfig.enabled" style="width:auto;margin-right:10px;">
<span>Activer les messages de bienvenue</span>
</label>
<label>Salon de bienvenue</label>
<select v-model="welcomeConfig.channelId">
<option :value="null">-- SÃ©lectionner un salon --</option>
<option v-for="ch in channels" :key="ch.id" :value="ch.id">{{ch.name}}</option>
</select>
</div>

<div class="field-group">
<h4>ğŸ’¬ Message</h4>
<label>Message de bienvenue</label>
<textarea v-model="welcomeConfig.message" rows="3" placeholder="Bienvenue {user} sur **{server}** ! ğŸ‰"></textarea>
<p style="font-size:12px;color:#999;margin-top:5px;">
Variables: {user}, {username}, {server}, {memberCount}
</p>
</div>

<div class="field-group">
<h4>ğŸ“‹ Embed</h4>
<label style="display:flex;align-items:center;margin-bottom:10px;">
<input type="checkbox" v-model="welcomeConfig.embedEnabled" style="width:auto;margin-right:10px;">
<span>Utiliser un embed</span>
</label>

<div v-if="welcomeConfig.embedEnabled">
<label>Titre de l'embed</label>
<input v-model="welcomeConfig.embedTitle" placeholder="Bienvenue !">

<label style="margin-top:10px;">Description de l'embed</label>
<textarea v-model="welcomeConfig.embedDescription" rows="2" placeholder="Bienvenue {user} ! ğŸ‘‹"></textarea>

<label style="margin-top:10px;">Couleur de l'embed</label>
<input type="color" v-model="welcomeConfig.embedColor" style="width:80px;">

<label style="display:flex;align-items:center;margin-top:10px;">
<input type="checkbox" v-model="welcomeConfig.embedThumbnail" style="width:auto;margin-right:10px;">
<span>Afficher l'avatar du membre</span>
</label>

<label style="margin-top:10px;">Footer de l'embed (optionnel)</label>
<input v-model="welcomeConfig.embedFooter" placeholder="Profite bien de ton sÃ©jour !">
</div>
</div>

<button @click="saveWelcome()" class="btn btn-success">ğŸ’¾ Sauvegarder</button>
</div>

<!-- Goodbye Config -->
<div v-show="welcomeTab==='goodbye'" class="card">
<h3 style="margin-bottom:15px;color:#ED4245;">Configuration des messages de dÃ©part</h3>

<div class="field-group">
<h4>ğŸ”§ ParamÃ¨tres gÃ©nÃ©raux</h4>
<label style="display:flex;align-items:center;margin-bottom:10px;">
<input type="checkbox" v-model="goodbyeConfig.enabled" style="width:auto;margin-right:10px;">
<span>Activer les messages de dÃ©part</span>
</label>
<label>Salon de dÃ©part</label>
<select v-model="goodbyeConfig.channelId">
<option :value="null">-- SÃ©lectionner un salon --</option>
<option v-for="ch in channels" :key="ch.id" :value="ch.id">{{ch.name}}</option>
</select>
</div>

<div class="field-group">
<h4>ğŸ’¬ Message</h4>
<label>Message de dÃ©part</label>
<textarea v-model="goodbyeConfig.message" rows="3" placeholder="{user} a quittÃ© le serveur... ğŸ˜¢"></textarea>
<p style="font-size:12px;color:#999;margin-top:5px;">
Variables: {user}, {username}, {server}, {memberCount}
</p>
</div>

<div class="field-group">
<h4>ğŸ“‹ Embed</h4>
<label style="display:flex;align-items:center;margin-bottom:10px;">
<input type="checkbox" v-model="goodbyeConfig.embedEnabled" style="width:auto;margin-right:10px;">
<span>Utiliser un embed</span>
</label>

<div v-if="goodbyeConfig.embedEnabled">
<label>Titre de l'embed</label>
<input v-model="goodbyeConfig.embedTitle" placeholder="Au revoir...">

<label style="margin-top:10px;">Description de l'embed</label>
<textarea v-model="goodbyeConfig.embedDescription" rows="2" placeholder="{user} a quittÃ© le serveur ğŸ‘‹"></textarea>

<label style="margin-top:10px;">Couleur de l'embed</label>
<input type="color" v-model="goodbyeConfig.embedColor" style="width:80px;">

<label style="display:flex;align-items:center;margin-top:10px;">
<input type="checkbox" v-model="goodbyeConfig.embedThumbnail" style="width:auto;margin-right:10px;">
<span>Afficher l'avatar du membre</span>
</label>

<label style="margin-top:10px;">Footer de l'embed (optionnel)</label>
<input v-model="goodbyeConfig.embedFooter" placeholder="">
</div>
</div>

<button @click="saveWelcome()" class="btn btn-success">ğŸ’¾ Sauvegarder</button>
</div>

</div>

<!-- Backups -->
<div v-show="v==='bak'">
<h2 style="font-size:28px;margin-bottom:20px;">ğŸ’¾ Backups ({{baks.length}})</h2>
<div class="card" style="margin-bottom:15px;">
<button @click="createBak()" class="btn btn-success">CrÃ©er Backup</button>
<button @click="load()" class="btn btn-primary">RafraÃ®chir</button>
</div>
<div class="card">
<div v-if="baks.length===0" style="text-center:center;padding:40px;opacity:0.7;">
<p>Aucun backup disponible</p>
</div>
<div v-else>
<div v-for="b in baks" :key="b.filename" style="padding:15px;background:#1a1a1a;margin-bottom:10px;border-radius:8px;display:flex;justify-content:space-between;align-items:center;">
<div>
<div style="font-weight:bold;margin-bottom:5px;">{{b.filename}}</div>
<div style="font-size:13px;opacity:0.7;">{{b.date}} - {{b.size}}</div>
</div>
<button @click="restoreBak(b.filename)" class="btn btn-danger">Restaurer</button>
</div>
</div>
</div>
</div>

<!-- ContrÃ´le Bot -->
<div v-show="v==='staff'">
<h2 style="font-size:28px;margin-bottom:20px;">ğŸ‘¥ Staff Management</h2>
<div class="card">
<h3>RÃ´les Staff ({{(staff.staffRoleIds||[]).length}})</h3>
<div v-if="(staff.staffRoleIds||[]).length>0" style="margin:15px 0;">
<div v-for="(roleId, index) in staff.staffRoleIds" :key="roleId" style="padding:10px;background:#1a1a1a;margin-bottom:8px;border-radius:6px;display:flex;justify-content:space-between;align-items:center;">
<div>
<strong>{{getRoleName(roleId)}}</strong>
<span style="opacity:0.6;font-size:11px;margin-left:10px;">{{roleId}}</span>
</div>
<button @click="removeStaffRole(index)" class="btn btn-danger" style="padding:6px 12px;font-size:13px;">âŒ Supprimer</button>
</div>
</div>
<p v-else style="opacity:0.7;padding:20px;text-align:center;">Aucun rÃ´le staff</p>
<button @click="saveStaff()" class="btn btn-success" style="margin-top:15px;">ğŸ’¾ Sauvegarder</button>
</div>
<div class="card">
<h3>ğŸ”’ Quarantaine</h3>
<div v-if="staff.quarantineRoleId" style="display:flex;justify-content:space-between;align-items:center;">
<p style="padding:10px;background:#1a1a1a;margin:10px 0;border-radius:6px;flex:1;">{{getRoleName(staff.quarantineRoleId)}}</p>
<button @click="staff.quarantineRoleId=null;saveStaff()" class="btn btn-danger" style="padding:6px 12px;font-size:13px;margin-left:10px;">âŒ Supprimer</button>
</div>
<p v-else style="opacity:0.7;padding:20px;text-align:center;">Non configurÃ©</p>
</div>
</div>

<div v-show="v==='autokick'">
<h2 style="font-size:28px;margin-bottom:20px;">âš¡ AutoKick</h2>
<div class="card">
<h3>Ã‰tat: <span :style="{color:autokick.enabled?'#57F287':'#ED4245'}">{{autokick.enabled?'ActivÃ©':'DÃ©sactivÃ©'}}</span></h3>
<p style="margin:15px 0;opacity:0.8;">RÃ´le requis: <strong>{{getRoleName(autokick.roleId)}}</strong></p>
<p style="margin:15px 0;opacity:0.8;">DÃ©lai: <strong>{{formatDelay(autokick.delayMs)}}</strong></p>
<p style="margin:15px 0;opacity:0.8;">En attente: <strong>{{Object.keys(autokick.pendingJoiners||{}).length}}</strong> membres</p>
</div>
</div>

<div v-show="v==='autothread'">
<h2 style="font-size:28px;margin-bottom:20px;">ğŸ§µ AutoThread</h2>
<div class="card">
<h3>Canaux ({{(autothread.channels||[]).length}})</h3>
<div v-if="(autothread.channels||[]).length>0" style="margin:15px 0;">
<div v-for="ch in autothread.channels" :key="ch" style="padding:8px;background:#1a1a1a;margin:5px 0;border-radius:6px;font-size:13px;">{{getChannelName(ch)}}</div>
</div>
<p v-else style="opacity:0.7;padding:20px;text-align:center;">Aucun canal</p>
</div>
</div>

<div v-show="v==='disboard'">
<h2 style="font-size:28px;margin-bottom:20px;">ğŸ“¢ Disboard</h2>
<div class="card">
<h3>Rappels: {{disboard.remindersEnabled?'ActivÃ©s':'DÃ©sactivÃ©s'}}</h3>
<p style="margin:15px 0;opacity:0.8;">Canal: <strong>{{getChannelName(disboard.remindChannelId)}}</strong></p>
<p style="margin:15px 0;opacity:0.8;">Dernier bump: <strong>{{disboard.lastBumpAt?new Date(disboard.lastBumpAt).toLocaleString('fr-FR'):'Jamais'}}</strong></p>
</div>
</div>

<div v-show="v==='geo'">
<h2 style="font-size:28px;margin-bottom:20px;">ğŸ—ºï¸ GÃ©olocalisation</h2>
<div class="card">
<h3>Membres ({{Object.keys(geo.locations||{}).length}})</h3>
<table v-if="Object.keys(geo.locations||{}).length>0">
<thead><tr><th>Membre</th><th>Ville</th><th>Date</th></tr></thead>
<tbody>
<tr v-for="(loc,uid) in geo.locations" :key="uid">
<td>{{getMemberName(uid)}}</td>
<td style="font-size:13px;">{{loc.city}}</td>
<td style="opacity:0.7;font-size:12px;">{{new Date(loc.updatedAt).toLocaleDateString('fr-FR')}}</td>
</tr>
</tbody>
</table>
<p v-else style="opacity:0.7;padding:20px;text-align:center;">Aucune localisation</p>
</div>
</div>

<!-- Section Actions -->
<div v-show="v==='actions'">
  <h2 style="font-size:28px;margin-bottom:20px;">âš¡ Gestion des Actions</h2>
  
  <div class="card">
    <h3 style="margin-bottom:15px;">SÃ©lectionner une action</h3>
    <select v-model="selectedAction" @change="loadActionMessages()" style="margin-bottom:20px;">
      <option value="">Choisir...</option>
      <option v-for="(actionData, actionName) in actionsData.list" :key="actionName" :value="actionName">
        {{ actionData.label || actionName }}
      </option>
    </select>
  </div>

  <div v-if="selectedAction">
    <div class="card">
      <h3 style="margin-bottom:15px;">{{ actionsData.list[selectedAction]?.label || selectedAction }}</h3>
      <p style="margin:5px 0;"><strong>Action:</strong> {{ selectedAction }}</p>
      <p v-if="actionsData.config[selectedAction]" style="margin:5px 0;">
        <strong>Cooldown:</strong> {{ actionsData.config[selectedAction].cooldown }}s | 
        <strong>SuccÃ¨s:</strong> {{ (actionsData.config[selectedAction].successRate * 100).toFixed(0) }}%
      </p>
      <p v-if="actionsData.config[selectedAction]?.zones" style="margin:5px 0;">
        <strong>Zones:</strong> {{ actionsData.config[selectedAction].zones.join(', ') }}
      </p>
    </div>

    <!-- Messages SuccÃ¨s -->
    <div class="card" style="background:#1e3a1e;">
      <h3 style="color:#4ade80;margin-bottom:15px;">âœ… Messages de SuccÃ¨s ({{ actionMessages.success.length }})</h3>
      <div style="max-height:400px;overflow-y:auto;">
        <div v-for="(msg, idx) in actionMessages.success" :key="'s-'+idx" 
             style="background:#2a4a2a;padding:12px;margin-bottom:8px;border-radius:6px;display:flex;justify-content:space-between;align-items:center;">
          <span style="flex:1;">{{ msg }}</span>
          <div>
            <button @click="editMessage('success', idx)" class="btn btn-primary" style="padding:6px 12px;font-size:14px;margin-right:5px;">âœï¸</button>
            <button @click="removeMessage('success', idx)" class="btn btn-danger" style="padding:6px 12px;font-size:14px;">ğŸ—‘ï¸</button>
          </div>
        </div>
        <p v-if="actionMessages.success.length === 0" style="color:#888;text-align:center;padding:30px;">Aucun message de succÃ¨s</p>
      </div>
    </div>

    <!-- Messages Ã‰chec -->
    <div class="card" style="background:#3a1e1e;">
      <h3 style="color:#ef4444;margin-bottom:15px;">âŒ Messages d'Ã‰chec ({{ actionMessages.fail.length }})</h3>
      <div style="max-height:400px;overflow-y:auto;">
        <div v-for="(msg, idx) in actionMessages.fail" :key="'f-'+idx" 
             style="background:#4a2a2a;padding:12px;margin-bottom:8px;border-radius:6px;display:flex;justify-content:space-between;align-items:center;">
          <span style="flex:1;">{{ msg }}</span>
          <div>
            <button @click="editMessage('fail', idx)" class="btn btn-primary" style="padding:6px 12px;font-size:14px;margin-right:5px;">âœï¸</button>
            <button @click="removeMessage('fail', idx)" class="btn btn-danger" style="padding:6px 12px;font-size:14px;">ğŸ—‘ï¸</button>
          </div>
        </div>
        <p v-if="actionMessages.fail.length === 0" style="color:#888;text-align:center;padding:30px;">Aucun message d'Ã©chec</p>
      </div>
    </div>

    <!-- Ajouter message -->
    <div class="card">
      <h3 style="margin-bottom:15px;">â• Ajouter un message</h3>
      <div class="field-group">
        <label style="display:block;margin-bottom:8px;">Type:</label>
        <select v-model="messageType" style="margin-bottom:15px;">
          <option value="success">âœ… SuccÃ¨s</option>
          <option value="fail">âŒ Ã‰chec</option>
        </select>
      </div>
      <div class="field-group">
        <label style="display:block;margin-bottom:8px;">Message:</label>
        <textarea v-model="newMessage" rows="4" placeholder="Entrez le message... (utilisez {cible} pour la cible)" style="margin-bottom:15px;"></textarea>
      </div>
      <button @click="addMessage()" class="btn btn-success" style="margin-right:10px;">â• Ajouter</button>
      <button @click="newMessage=''" class="btn" style="background:#666;">ğŸ—‘ï¸ Effacer</button>
    </div>

    <!-- Sauvegarder -->
    <div style="text-align:center;">
      <button @click="saveActionMessages()" class="btn btn-primary" style="font-size:20px;padding:15px 40px;">
        ğŸ’¾ Sauvegarder tous les messages
      </button>
    </div>
  </div>
</div>



<div v-show="v==='ctrl'">
<h2 style="font-size:28px;margin-bottom:20px;">ğŸ® ContrÃ´le Bot</h2>
<div class="card">
<h3 style="margin-bottom:20px;font-size:20px;">Actions</h3>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
<button @click="restartBot()" class="btn btn-danger" style="width:100%;padding:15px;font-size:16px;">
<div style="font-size:24px;margin-bottom:5px;">ğŸ”„</div>
RedÃ©marrer Bot
</button>
<button @click="deployCmd()" class="btn btn-success" style="width:100%;padding:15px;font-size:16px;">
<div style="font-size:24px;margin-bottom:5px;">ğŸš€</div>
DÃ©ployer Commandes
</button>
</div>
<div style="margin-top:30px;padding:20px;background:#1a1a1a;border-radius:8px;">
<h4 style="margin-bottom:15px;">Ã‰tat</h4>
<p style="margin-bottom:10px;">Status: <span style="color:#57F287;font-weight:bold;">EN LIGNE</span></p>
<p style="margin-bottom:10px;">Commandes dÃ©ployÃ©es: <strong>74</strong></p>
<p>Dashboard V2: <strong>v2.0</strong></p>
</div>
</div>
</div>

</div>
</div>

<script>
const{createApp}=Vue;
createApp({
data(){return{
v:'d',
ecoT:'u',eco:{},ecoW:50,ecoF:30,curr:'BAG$',cool:{},actCfg:{},selAct:null,curAct:null,karmaRes:{},
nivT:'u',niv:{},nivXpMsgMin:15,nivXpMsgMax:35,nivXpVoiceMin:5,nivXpVoiceMax:35,nivCoolMsg:0,nivCoolVoice:60,nivRewards:{},
boost:{enabled:false,textXpMult:2,voiceXpMult:2,actionCooldownMult:0.5,shopPriceMult:0.5,roles:[]},
countFormulas:false,countState:{},countAch:[],
avT:'config',avMode:'sfw',avType:'v',tdS:[],tdN:[],tdSfwCh:[],tdNsfwCh:[],baks:[],tickT:'config',tickEnabled:false,tickCounter:0,tickConfig:{},tickCats:[],tickRecords:{},tickPanel:{},channels:{},editingCat:-1,editingConfig:false,members:{},roles:{},
welcomeTab:'welcome',
welcomeConfig:{enabled:false,channelId:null,message:'',embedEnabled:true,embedTitle:'',embedDescription:'',embedColor:'#5865F2',embedThumbnail:true,embedFooter:''},
goodbyeConfig:{enabled:false,channelId:null,message:'',embedEnabled:true,embedTitle:'',embedDescription:'',embedColor:'#ED4245',embedThumbnail:false,embedFooter:null},
staff:{staffRoleIds:[],quarantineRoleId:null,footerLogoUrl:"",categoryBanners:{}},
autokick:{enabled:false,roleId:null,delayMs:0,pendingJoiners:{}},
autothread:{channels:[],naming:{mode:"nsfw",customPattern:""},archivePolicy:"1w",nsfwNames:[]},
disboard:{remindersEnabled:true,remindChannelId:null,lastBumpAt:null,lastBumpChannelId:null,reminded:false},
geo:{locations:{}},
confess:{sfw:{channels:[]},nsfw:{channels:[]},logChannelId:null},
countChannels:[],
logChannels:{},
nivLevelUpChannel:null,
nivRoleAwardChannel:null,
tdNewPrompts:"",
tdNewType:"verite",
// Actions
actionsData:{list:{},messages:{},gifs:{},config:{}},
selectedAction:'''',
actionMessages:{success:[],fail:[]},
newMessage:'''',
messageType:'success'
}},
async mounted(){
console.log('ğŸš€ Dashboard V2 Ultra-Complet mounted');
await this.load();
},
methods:{
async loadMusic(){console.log('Musique chargÃ©e')},

uploadImage(e,field){
const file=e.target.files[0];
if(!file){return;}
if(file.size>5*1024*1024){alert('âŒ Fichier trop gros (max 5MB)');return;}
const reader=new FileReader();
reader.onload=(ev)=>{
const base64=ev.target.result;
if(field==='imageUrl')this.tickPanel.imageUrl=base64;
else if(field==='thumbnailUrl')this.tickPanel.thumbnailUrl=base64;
else if(field.startsWith('banner')){
const idx=parseInt(field.split('-')[1]);
this.tickCats[idx].bannerUrl=base64;
}
};
reader.readAsDataURL(file);
},
async savePanel(){
if(!confirm('Sauvegarder le panel?'))return;
const r=await this.api('/api/tickets',{method:'POST',body:JSON.stringify({panel:this.tickPanel})});
if(r&&r.success){alert('âœ… Panel sauvegardÃ©');}else{alert('âŒ Erreur');}
},
async saveConfig(){
if(!confirm('Sauvegarder la configuration?'))return;
const r=await this.api('/api/tickets',{method:'POST',body:JSON.stringify({config:this.tickConfig})});
if(r&&r.success){alert('âœ… Config sauvegardÃ©e');this.editingConfig=false;}else{alert('âŒ Erreur');}
},
getMemberName(id){
if(!id)return'Inconnu';
return this.members[id]||id;
},
sortedEco(){const arr=Object.entries(this.eco||{});return arr.sort((a,b)=>(b[1].amount||0)-(a[1].amount||0));},
sortedNiv(){const arr=Object.entries(this.niv||{});return arr.sort((a,b)=>{const levelDiff=(b[1].level||0)-(a[1].level||0);if(levelDiff!==0)return levelDiff;return(b[1].xp||0)-(a[1].xp||0);});},
getRoleName(id){
if(!id)return'Inconnu';
const r=this.roles[id];return r?.name||id;
},
getChannelName(id){if(!id)return'Non configurÃ©';const ch=this.channels[id];return ch?.name||id;},
async saveCat(idx){if(!confirm('Sauvegarder?'))return;const r=await this.api('/api/tickets',{method:'POST',body:JSON.stringify({categories:this.tickCats})});if(r&&r.success){alert('âœ… SauvegardÃ©');this.editingCat=-1;}else{alert('âŒ Erreur');}},
async loadStaff(){const r=await this.api('/api/staff');if(r){this.staff=r;console.log('âœ“ Staff');}},
async saveStaff(){if(!confirm('Sauvegarder?'))return;const r=await this.api('/api/staff',{method:'POST',body:JSON.stringify(this.staff)});if(r&&r.success){alert('âœ… OK');}else{alert('âŒ Erreur');}},
removeStaffRole(index){
if(!confirm('Supprimer ce rÃ´le staff?'))return;
this.staff.staffRoleIds.splice(index,1);
},
async loadAutoKick(){const r=await this.api('/api/autokick');if(r){this.autokick=r;console.log('âœ“ AutoKick');}},
async saveAutoKick(){if(!confirm('Sauvegarder?'))return;const r=await this.api('/api/autokick',{method:'POST',body:JSON.stringify(this.autokick)});if(r&&r.success){alert('âœ… OK');}else{alert('âŒ Erreur');}},
async loadAutoThread(){const r=await this.api('/api/autothread');if(r){this.autothread=r;console.log('âœ“ AutoThread');}},
async saveAutoThread(){if(!confirm('Sauvegarder?'))return;const r=await this.api('/api/autothread',{method:'POST',body:JSON.stringify(this.autothread)});if(r&&r.success){alert('âœ… OK');}else{alert('âŒ Erreur');}},
async loadDisboard(){const r=await this.api('/api/disboard');if(r){this.disboard=r;console.log('âœ“ Disboard');}},
async saveDisboard(){if(!confirm('Sauvegarder?'))return;const r=await this.api('/api/disboard',{method:'POST',body:JSON.stringify(this.disboard)});if(r&&r.success){alert('âœ… OK');}else{alert('âŒ Erreur');}},
async loadGeo(){const r=await this.api('/api/geo');if(r){this.geo=r;console.log('âœ“ Geo');}},
async loadActions(){
const data=await this.api('/api/actions');
if(data){
this.actionsData=data;
if(Object.keys(data.list).length>0&&!this.selectedAction){
this.selectedAction=Object.keys(data.list)[0];
this.loadActionMessages();
}
}
},
loadActionMessages(){
if(!this.selectedAction)return;
const messages=this.actionsData.messages[this.selectedAction]||{success:[],fail:[]};
this.actionMessages={success:[...messages.success],fail:[...messages.fail]};
},
async saveActionMessages(){
const r=await this.api('/api/actions/messages',{method:'POST',body:JSON.stringify({actionName:this.selectedAction,success:this.actionMessages.success,fail:this.actionMessages.fail})});
if(r&&r.success){alert('âœ… Messages sauvegardÃ©s');await this.loadActions();}
},
addMessage(){
if(!this.newMessage.trim())return;
if(this.messageType==='success'){this.actionMessages.success.push(this.newMessage.trim());}else{this.actionMessages.fail.push(this.newMessage.trim());}
this.newMessage='';
},
removeMessage(type,index){if(confirm('Supprimer ce message ?')){this.actionMessages[type].splice(index,1);}},
editMessage(type,index){const newText=prompt('Modifier le message:',this.actionMessages[type][index]);if(newText!==null&&newText.trim()){this.actionMessages[type][index]=newText.trim();}}},
formatDelay(ms){if(!ms)return'Non configurÃ©';const d=Math.floor(ms/86400000);const h=Math.floor((ms%86400000)/3600000);return d>0?d+' j':h+' h';},
async loadTruthDare(){const r=await this.api('/api/truthdare');if(r){this.tdConfig=r;this.tdSfwCh=r.sfw.channels;this.tdNsfwCh=r.nsfw.channels;this.tdS=r.sfw.prompts;this.tdN=r.nsfw.prompts;}},
async submitTdPrompts(mode){if(!this.tdNewPrompts||!this.tdNewPrompts.trim()){alert('âš ï¸ Veuillez entrer au moins un prompt');return;}const lines=this.tdNewPrompts.trim().split('\n').filter(l=>l.trim());const prompts=[];let errors=0;for(const line of lines){const parts=line.split('|').map(p=>p.trim());if(parts.length<2){errors++;continue;}const type=parts[0].toLowerCase();const text=parts.slice(1).join('|').trim();if((type==='verite'||type==='action')&&text){prompts.push({type,text});}else{errors++;}}if(prompts.length===0){alert('âŒ Aucun prompt valide trouvÃ©');return;}if(errors>0&&!confirm(`âš ï¸ ${errors} ligne(s) invalide(s) ignorÃ©e(s).\n\nAjouter les ${prompts.length} prompt(s) valide(s)?`))return;let added=0;for(const prompt of prompts){const r=await this.api('/api/truthdare',{method:'POST',body:JSON.stringify({mode,action:'add',prompt})});if(r&&r.success)added++;}this.tdNewPrompts='';alert(`âœ… ${added} prompt(s) ajoutÃ©(s)`);await this.loadTruthDare();
        await this.loadActions();},
async submitTdPromptsSimple(mode){if(!this.tdNewPrompts||!this.tdNewPrompts.trim()){alert('âš ï¸ Veuillez entrer au moins un prompt');return;}const lines=this.tdNewPrompts.trim().split('
').filter(l=>l.trim());const type=this.tdNewType||'verite';let added=0;for(const line of lines){const text=line.trim();if(!text)continue;const r=await this.api('/api/truthdare',{method:'POST',body:JSON.stringify({mode,action:'add',prompt:{type,text}})});if(r&&r.success)added++;}this.tdNewPrompts='';alert();await this.loadTruthDare();},
async addTdChannel(mode){const channelId=prompt('Entrez l''ID du channel Ã  ajouter:');if(!channelId||!channelId.trim())return;const id=channelId.trim();const channels=mode==='sfw'?[...this.tdSfwCh,id]:[...this.tdNsfwCh,id];const r=await this.api('/api/truthdare',{method:'POST',body:JSON.stringify({mode,channels})});if(r&&r.success){alert('âœ… Channel ajoutÃ©');await this.loadTruthDare();}else{alert('âŒ Erreur');}},
async removeTdChannel(mode,idx){if(!confirm('Supprimer ce channel?'))return;const channels=mode==='sfw'?[...this.tdSfwCh]:[...this.tdNsfwCh];channels.splice(idx,1);const r=await this.api('/api/truthdare',{method:'POST',body:JSON.stringify({mode,channels})});if(r&&r.success){alert('âœ… Channel supprimÃ©');await this.loadTruthDare();}else{alert('âŒ Erreur');}},

async api(u,o={}){
try{
const r=await fetch(`http://82.67.65.98:3002${u}`,{...o,headers:{'Content-Type':'application/json'}});
const d=await r.json();
console.log('âœ“',u.split('/').pop());
return d;
}catch(e){console.error(e);return null}
},
async load(){
console.log('Chargement...');
const cfg=await this.api('/api/configs');
if(cfg){
if(cfg.economy){
this.eco=cfg.economy.balances||{};
this.ecoW=cfg.economy.settings?.baseWorkReward||50;
this.ecoF=cfg.economy.settings?.baseFishReward||30;
this.curr=cfg.economy.currency?.name||'BAG$';
this.cool=cfg.economy.settings?.cooldowns||{};
this.actCfg=cfg.economy.actions?.config||{};
this.karmaRes=cfg.economy.karmaReset||{};
if(cfg.economy.booster){
this.boost=cfg.economy.booster;
}
console.log('âœ“ Ã‰co:',Object.keys(this.eco).length);
}
if(cfg.levels){
this.niv=cfg.levels.users||{};
this.nivXpMsgMin=cfg.levels.xpMessageMin||15;
this.nivXpMsgMax=cfg.levels.xpMessageMax||35;
this.nivXpVoiceMin=cfg.levels.xpVoiceMin||5;
this.nivXpVoiceMax=cfg.levels.xpVoiceMax||35;
this.nivCoolMsg=cfg.levels.messageCooldownSec||0;
this.nivCoolVoice=cfg.levels.voiceCooldownSec||60;
this.nivRewards=cfg.levels.rewards||{};
if(cfg.levels.announce){
this.nivLevelUpChannel=cfg.levels.announce.levelUp?.channelId||null;
this.nivRoleAwardChannel=cfg.levels.announce.roleAward?.channelId||null;
}
console.log('âœ“ Niv:',Object.keys(this.niv).length);
}
if(cfg.confess){
this.confess=cfg.confess;
console.log('âœ“ Confess');
}
if(cfg.counting){
this.countChannels=cfg.counting.channels||[];
console.log('âœ“ Count channels');
}
if(cfg.logs&&cfg.logs.channels){
this.logChannels=cfg.logs.channels;
console.log('âœ“ Log channels:',Object.keys(this.logChannels).length);
}
if(cfg.truthdare){
this.tdS=cfg.truthdare.sfw?.prompts||[];
this.tdN=cfg.truthdare.nsfw?.prompts||[];
this.tdSfwCh=cfg.truthdare.sfw?.channels||[];
this.tdNsfwCh=cfg.truthdare.nsfw?.channels||[];
console.log('âœ“ TD:',this.tdS.length+this.tdN.length);
}
if(cfg.counting){
this.countFormulas=cfg.counting.allowFormulas||false;
this.countState=cfg.counting.state||{};
this.countAch=cfg.counting.achievedNumbers||[];
}
if(cfg.tickets){
this.tickEnabled=cfg.tickets.enabled||false;
this.tickCounter=cfg.tickets.counter||0;
this.tickConfig={
categoryId:cfg.tickets.categoryId||null,
panelChannelId:cfg.tickets.panelChannelId||null,
logChannelId:cfg.tickets.logChannelId||null,
transcriptChannelId:cfg.tickets.transcriptChannelId||null
};
this.tickCats=cfg.tickets.categories||[];
this.tickRecords=cfg.tickets.records||{};
this.tickPanel=cfg.tickets.panel||{};
console.log('âœ“ Tickets:',Object.keys(this.tickRecords).length);
}
const ch=await this.api('/api/discord/channels');
if(ch)this.channels=ch;
const memb=await this.api('/api/discord/members');
if(memb)this.members=memb;
const roles=await this.api('/api/discord/roles');
if(roles)this.roles=roles;
const bak=await this.api('/backup');
if(bak)this.baks=bak.backups||[];
}
},
loadAct(){this.curAct=this.actCfg[this.selAct]||{};},
async saveEco(){
await this.api('/api/economy',{method:'POST',body:JSON.stringify({settings:{baseWorkReward:this.ecoW,baseFishReward:this.ecoF,cooldowns:this.cool},currency:{name:this.curr}})});
alert('âœ… SauvegardÃ©');
},
async createBak(){
if(!confirm('CrÃ©er backup?'))return;
const r=await this.api('/backup',{method:'POST'});
if(r){alert('âœ… CrÃ©Ã©');await this.load();}
},
async restoreBak(f){
if(!confirm(`Restaurer ${f}?`))return;
const r=await this.api('/restore',{method:'POST',body:JSON.stringify({filename:f})});
if(r){alert('âœ… RestaurÃ©');location.reload();}
},
async restartBot(){
if(!confirm('RedÃ©marrer le bot?'))return;
const r=await this.api('/bot/control',{method:'POST',body:JSON.stringify({action:'restart'})});
if(r)alert('âœ… Bot en cours de redÃ©marrage...');
},
async deployCmd(){
if(!confirm('DÃ©ployer toutes les commandes?'))return;
const r=await this.api('/bot/control',{method:'POST',body:JSON.stringify({action:'deploy'})});
if(r)alert('âœ… DÃ©ploiement en cours...');
},

async loadWelcome(){
try{
const r=await this.api('/api/welcome');
if(r&&r.welcome){
this.welcomeConfig={...this.welcomeConfig,...r.welcome};
}
if(r&&r.goodbye){
this.goodbyeConfig={...this.goodbyeConfig,...r.goodbye};
}
console.log('âœ… Welcome/Goodbye config loaded');
}catch(e){
console.error('Error loading welcome config:',e);
alert('âŒ Erreur lors du chargement');
}
},

async saveWelcome(){
try{
const payload={
welcome:this.welcomeConfig,
goodbye:this.goodbyeConfig
};
const r=await this.api('/api/welcome',{method:'POST',body:JSON.stringify(payload)});
if(r&&r.success){
alert('âœ… Configuration sauvegardÃ©e !');
}else{
alert('âŒ Erreur lors de la sauvegarde');
}
}catch(e){
console.error('Error saving welcome config:',e);
alert('âŒ Erreur lors de la sauvegarde');
}
}
}).mount('#app');
</script>
</body>
</html>
